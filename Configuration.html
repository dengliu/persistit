<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration &mdash; Persistit 3.3.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Persistit 3.3.1 documentation" href="index.html" />
    <link rel="next" title="Management" href="Management.html" />
    <link rel="prev" title="Physical B+Tree Representation" href="PhysicalStorage.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="Management.html" title="Management"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="PhysicalStorage.html" title="Physical B+Tree Representation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Persistit 3.3.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>To initialize Akiban Persistit the embedding application specifies a configuration and then invokes the <a class="reference external" href="apidocs/com/persistit/Persistit.html#initialize()">initialize</a> method. The configuration defines parameters used to determine locations of files, sizes of buffer pool and journal files, policies and other elements required when Persistit starts up. These parameters are managed by the <a class="reference external" href="apidocs/com/persistit/Configuration.html">com.persistit.Configuration</a> class.</p>
<p>An application can define the configuration in one of two equivalent ways:</p>
<ul class="simple">
<li>Create a <a class="reference external" href="apidocs/com/persistit/Configuration.html">com.persistit.Configuration</a> instance and set its properties through methods such as <a class="reference external" href="apidocs/com/persistit/Configuration.html#setJournalPath(java.lang.String)">setJournalPath</a>.</li>
<li>Specify properties by name in a <tt class="docutils literal"><span class="pre">java.util.Properties</span></tt> instance and then pass the <tt class="docutils literal"><span class="pre">Properties</span></tt> to a <tt class="docutils literal"><span class="pre">Configuration</span></tt> constructor.</li>
</ul>
<p>The following code samples show different ways of configuring and starting Persistit:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">final</span> <span class="n">Persistit</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Persistit</span><span class="o">();</span>
<span class="kd">final</span> <span class="n">Properties</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
<span class="n">p</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;buffer.count.16384&quot;</span><span class="o">,</span> <span class="s">&quot;1000&quot;</span><span class="o">);</span>
<span class="n">p</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;journalpath&quot;</span><span class="o">,</span> <span class="s">&quot;/home/akiban/data/journal&quot;</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">db</span><span class="o">.</span><span class="na">setProperties</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">final</span> <span class="n">Persistit</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Persistit</span><span class="o">();</span>
<span class="n">db</span><span class="o">.</span><span class="na">setPropertiesFromFile</span><span class="o">(</span><span class="s">&quot;/home/akiban/my_config.properties&quot;</span><span class="o">);</span>
<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">final</span> <span class="n">Persistit</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Persistit</span><span class="o">();</span>
<span class="kd">final</span> <span class="n">Configuration</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">();</span>
<span class="n">c</span><span class="o">.</span><span class="na">getBufferPoolMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">16384</span><span class="o">).</span><span class="na">setCount</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
<span class="n">c</span><span class="o">.</span><span class="na">setJournalPath</span><span class="o">(</span><span class="s">&quot;/home/akiban/data/journal&quot;</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">db</span><span class="o">.</span><span class="na">setConfiguration</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>
</pre></div>
</div>
<p>There are three essential elements in a Persistit configuration:</p>
<ul class="simple">
<li>Memory for the buffer pool(s)</li>
<li>Specifications for <a class="reference external" href="apidocs/com/persistit/Volume.html">com.persistit.Volume</a> instances</li>
<li>Journal file path</li>
</ul>
<div class="section" id="configuring-the-buffer-pool">
<h2>Configuring the Buffer Pool<a class="headerlink" href="#configuring-the-buffer-pool" title="Permalink to this headline">¶</a></h2>
<p>During initialization Persistit allocates a fixed amount of heap memory for use as buffers. Depending on the application, it is usually desirable to allocate most of a server’s physical memory to the JVM heap (using the <tt class="docutils literal"><span class="pre">-Xmx</span></tt> and <tt class="docutils literal"><span class="pre">-Xms</span></tt> JVM options) and then to allocate a large fraction of the heap to Persistit buffers. The buffer pool allocation is determined during initialization and remains constant until the embedding application calls <a class="reference external" href="apidocs/com/persistit/Persistit.html#close()">close</a> to release all resources.</p>
<p>The number of buffers, and therefore the heap memory consumed, is determined during initialization by the available heap memory and configuration parameters. The heap memory size is obtained from the platform MemoryMXBean which in turn supplies the value given by the <tt class="docutils literal"><span class="pre">-Xmx</span></tt> JVM property. Configuration parameters are specified by a collection of five <a class="reference external" href="apidocs/com/persistit/Configuration.BufferPoolConfiguration.html">com.persistit.Configuration.BufferPoolConfiguration</a> objects, one for each of the possible buffer sizes 1,024, 2,048, 4,096, 8,192 and 16,384 bytes. The method <a class="reference external" href="apidocs/com/persistit/Configuration.html#getBufferPoolMap()">getBufferPoolMap</a> gets the <tt class="docutils literal"><span class="pre">BufferPoolConfiguration</span></tt> for a specified buffer size.</p>
<p>A <tt class="docutils literal"><span class="pre">BufferPoolConfiguration</span></tt> contains the following attributes:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">minimumCount</span></tt></dt>
<dd>lower bound on the number of buffers. (Default is zero.)</dd>
<dt><tt class="docutils literal"><span class="pre">maximumCount</span></tt></dt>
<dd>upper bound on the number of buffers. (Default is zero.)</dd>
<dt><tt class="docutils literal"><span class="pre">minimumMemory</span></tt></dt>
<dd>lower bound on memory to allocate. (Default is zero bytes.)</dd>
<dt><tt class="docutils literal"><span class="pre">maximumMemory</span></tt></dt>
<dd>upper bound on memory to allocate. (Default is Long.MAX_VALUE bytes.)</dd>
<dt><tt class="docutils literal"><span class="pre">reservedMemory</span></tt></dt>
<dd>minimum number of bytes to reserve for use other than buffers.  (Default is zero.)</dd>
<dt><tt class="docutils literal"><span class="pre">fraction</span></tt></dt>
<dd>floating point value between 0.0f and 1.0f indicating how much of available memory too allocate.  (Default is 1.0f.)</dd>
</dl>
</div></blockquote>
<p>Persistit uses the following algorithm to determine the number of buffers to allocate for each buffer size:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">memoryToUse</span> <span class="o">=</span> <span class="n">fraction</span> <span class="o">*</span> <span class="o">(</span><span class="n">maxHeap</span> <span class="o">-</span> <span class="n">reservedMemory</span><span class="o">)</span>
<span class="n">memoryToUse</span> <span class="o">=</span> <span class="n">min</span><span class="o">(</span><span class="n">memoryToUse</span><span class="o">,</span> <span class="n">maximumMemory</span><span class="o">)</span>
<span class="n">bufferCount</span> <span class="o">=</span> <span class="n">memoryToUse</span> <span class="o">/</span> <span class="n">bufferSizeWithOverhead</span>
<span class="n">bufferCount</span> <span class="o">=</span> <span class="n">max</span><span class="o">(</span><span class="n">minimumCount</span><span class="o">,</span> <span class="n">min</span><span class="o">(</span><span class="n">maximumCount</span><span class="o">,</span> <span class="n">bufferCount</span><span class="o">))</span>
<span class="k">if</span> <span class="o">(</span><span class="n">bufferCount</span> <span class="o">*</span> <span class="n">bufferSize</span> <span class="o">&gt;</span> <span class="n">maximumMemory</span><span class="o">)</span> <span class="n">then</span> <span class="n">FAIL</span>
<span class="k">if</span> <span class="o">((</span><span class="n">bufferCount</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">bufferSize</span> <span class="o">&lt;</span> <span class="n">minimumMemory</span><span class="o">)</span> <span class="n">then</span> <span class="n">FAIL</span>
<span class="n">allocate</span> <span class="n">bufferCount</span> <span class="n">buffers</span>
</pre></div>
</div>
<p>In other words, Persistit computes a buffer count based on the memory parameters, bounds it by <tt class="docutils literal"><span class="pre">minimumCount</span></tt> and <tt class="docutils literal"><span class="pre">maximumCount</span></tt> and then checks whether the resulting allocation fits within the memory constraints. Note that <tt class="docutils literal"><span class="pre">bufferSizeWithOverhead</span></tt> is about 14% larger than the buffer size; the additional memory is reserved for indexing data and other overhead associated with the buffer.</p>
<p>Typically an application uses a single buffer size, specifying either an absolute count or memory-based constraints for that size. This can be done by setting the attributes of the appropriate <tt class="docutils literal"><span class="pre">BufferPoolConfiguration</span></tt> object directly, or using Property values.</p>
<p>The property named <tt class="docutils literal"><span class="pre">buffer.count.SSSS</span></tt> where <tt class="docutils literal"><span class="pre">SSSS</span></tt> is “1024”, “2048”, “4096”, “8192” or “16384” specifies an absolute count.  For example,</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">buffer</span><span class="o">.</span><span class="na">count</span><span class="o">.</span><span class="mi">8192</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
<p>causes Persistit to allocate 10,000 buffers of size 8192.</p>
<p>The property <tt class="docutils literal"><span class="pre">buffer.memory.SSSS</span></tt> specifies memory constraints as shown in this example</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">buffer</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="mi">8192</span> <span class="o">=</span> <span class="mi">512</span><span class="n">K</span><span class="o">,</span><span class="mi">20</span><span class="n">M</span><span class="o">,</span><span class="mi">4</span><span class="n">M</span><span class="o">,</span><span class="mf">0.6</span>
</pre></div>
</div>
<p>where 512K, 20M, 4M and 0.6 are the <tt class="docutils literal"><span class="pre">minimumMemory</span></tt>, <tt class="docutils literal"><span class="pre">maximumMemory</span></tt>, <tt class="docutils literal"><span class="pre">reservedMemory</span></tt> and <tt class="docutils literal"><span class="pre">fraction</span></tt>, respectively.</p>
<p>The MemoryMXBean supplies as its maximum heap size value the size given by the <tt class="docutils literal"><span class="pre">-Xmx</span></tt> JVM parameter.</p>
</div>
<div class="section" id="heap-tuning">
<h2>Heap Tuning<a class="headerlink" href="#heap-tuning" title="Permalink to this headline">¶</a></h2>
<p>This section pertains to the Oracle HotSpot(tm) Java virtual machine.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buffer instances are long-lived objects. To avoid severe garbage collector overhead it is important for all of them
to fit in the heap’s tenured generation. This issue becomes especially significant with multi-gigabyte heaps.</p>
</div>
<p>By default the HotSpot server JVM allocates 1/3 of the heap to the new generation and 2/3 to the tenured generation, meaning that allocating more than 2/3 of the heap to buffers will result in bad performance.</p>
<p>You can increase the fraction by specifying <tt class="docutils literal"><span class="pre">-XX:NewRatio=N</span></tt> where <tt class="docutils literal"><span class="pre">N</span></tt> indicates the ratio of tenured generation space to new generation space, or by using the <tt class="docutils literal"><span class="pre">-Xmn</span></tt> parameter to specify an absolute amount of memory for the new generation.  Also, setting <tt class="docutils literal"><span class="pre">-Xms</span></tt> equal to <tt class="docutils literal"><span class="pre">-Xmx</span></tt> will avoid numerous garbage collection cycles during the start-up process.</p>
<p>See [<a class="reference external" href="http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html">http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html</a>] for further information on tuning the heap and garbage collector for the HotSpot JVM.</p>
</div>
<div class="section" id="multiple-buffer-pools">
<h2>Multiple Buffer Pools<a class="headerlink" href="#multiple-buffer-pools" title="Permalink to this headline">¶</a></h2>
<p>In some cases it may be desirable to allocate two or more buffer pools having buffers of different sizes. For example, it may be beneficial to use a large number of small buffers to hold secondary index pages.</p>
<p>When specifying multiple memory constraints for multiple buffer pools, the <tt class="docutils literal"><span class="pre">fraction</span></tt> property applies to the available memory before any buffers are allocated. So, for example,</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">buffer</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="mi">2048</span><span class="o">=</span><span class="mi">64</span><span class="n">M</span><span class="o">,</span><span class="mi">512</span><span class="n">G</span><span class="o">,</span><span class="mi">2</span><span class="n">G</span><span class="o">,.</span><span class="mi">2</span>
<span class="n">buffer</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="mi">16384</span><span class="o">=</span><span class="mi">64</span><span class="n">M</span><span class="o">,</span><span class="mi">512</span><span class="n">G</span><span class="o">,</span><span class="mi">2</span><span class="n">G</span><span class="o">,.</span><span class="mi">5</span>
</pre></div>
</div>
<p>results in two buffer pools having buffers of size 2,048 bytes and 16,384 bytes, respectively. Assuming that the <tt class="docutils literal"><span class="pre">-Xmx</span></tt> value is 12G, then 2,048 byte buffers will be allocated to fill 20% of 10GByte, 16,384 byte buffers will be allocated to fill 50% of 10GByte, and approximately 5GByte (30% of 10GByte plus 2GByte reserved) will be available to application code.</p>
</div>
<div class="section" id="configuring-volumes">
<h2>Configuring Volumes<a class="headerlink" href="#configuring-volumes" title="Permalink to this headline">¶</a></h2>
<p>Persistit creates and/or opens a set of database volume files during start-up. An application can create, open and close additional volumes, but it is often convenient for volumes to be defined in the confiuration, outside of application code.</p>
<p>The <a class="reference external" href="apidocs/com/persistit/Configuration.html#getVolumeList()">getVolumeList</a> method returns a List of <a class="reference external" href="apidocs/com/persistit/VolumeSpecification.html">com.persistit.VolumeSpecification</a> objects. An application can construct and add new <tt class="docutils literal"><span class="pre">VolumeSpecification</span></tt> instances to this list before calling <a class="reference external" href="apidocs/com/persistit/Persistit.html#initialize()">initialize</a>.  Alternatively, the application can define volume specifications as property values using the syntax:</p>
<p><tt class="docutils literal"><span class="pre">volume.N</span> <span class="pre">=</span> <span class="pre">path[,attrname[:attrvalue]]...</span></tt></p>
<p>where <tt class="docutils literal"><span class="pre">N</span></tt> is an arbitrary integer, <tt class="docutils literal"><span class="pre">path</span></tt> is the path specification of the volume file, and <tt class="docutils literal"><span class="pre">attrnames</span></tt> include:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pageSize</span></tt>: Fixed length unit representing one page. Value must be one of 1024, 2048, 4096, 8192 or 16384. To open and use the Volume, the buffer pool must have available buffers of the same size.</li>
<li><tt class="docutils literal"><span class="pre">create</span></tt>: Persistit attempts to open an existing volume file with the specified <em>path</em>, or create a new one if the file does not exist.</li>
<li><tt class="docutils literal"><span class="pre">createOnly</span></tt>: Persistit throw a VolumeAlreadyExistsException if the file specified by path already exists. Otherwise it creates a new file with the specified path.</li>
<li><tt class="docutils literal"><span class="pre">readOnly</span></tt>: Opens a volume in read-only mode. An attempt to modify the volume results in a ReadOnlyVolumeException.</li>
<li><tt class="docutils literal"><span class="pre">initialPages</span></tt> or <tt class="docutils literal"><span class="pre">initialSize</span></tt>: Specifies the initial size of the newly created volume file, either as the count of pages or as the size in bytes.</li>
<li><tt class="docutils literal"><span class="pre">extensionPages</span></tt> or <tt class="docutils literal"><span class="pre">extensionSize</span></tt>: Specifies the extension size of the newly created volume, either as the count of pages or as the size in bytes. This is the size by which the volume file will expand when the volume needs to be enlarged.</li>
<li><tt class="docutils literal"><span class="pre">maximumPages</span></tt> or <tt class="docutils literal"><span class="pre">maximumSize</span></tt>: An upper limit on the number of pages this Volume may hold, either as the count of pages or as the size in bytes. An attempt to further enlarge the Volume will generate a VolumeFullException.</li>
<li><tt class="docutils literal"><span class="pre">alias</span></tt>: The name of this Volume used in constructing <tt class="docutils literal"><span class="pre">Exchange</span></tt> instances.  If unspecified, the name is the simple file name given in the <em>path</em>, not including its dotted suffix.</li>
</ul>
<p>For example:</p>
<div class="highlight-python"><pre>volume.1=/home/akiban/ffdemo,create,pageSize:16K,\
    initialSize:10M,extensionSize:10M,maximumSize:1G</pre>
</div>
<p>specifies a volume having the name “ffdemo” in the /home/akiban directory. A new volume will be created if there is no existing volume file, and when created it will have the initial, extension and maximum sizes of 10MByte, 10MByte and 1GByte, respectively. Its page size will be 16KByte, meaning that the configuration must also have a buffer pool of 16KByte buffers.</p>
</div>
<div class="section" id="system-volume">
<h2>System Volume<a class="headerlink" href="#system-volume" title="Permalink to this headline">¶</a></h2>
<p>One volume in a Persistit configuration must be designated as the system volume. It contains class meta data for objects stored serialized in Persistit Values. When a configuration specifies only one volume, that volume implicitly becomes the system volume by default. However, when a configuration specifies multiple volumes, you must indicate which volume will serve as the system volume. There are two ways to do this. By default, Persistit looks for a unique volume named “_system”. You can simply create a volume whose file name is “_system”.</p>
<p>Alternatively, you can specify a system volume name explicitly with the <tt class="docutils literal"><span class="pre">sysvolume</span></tt> property (or <a class="reference external" href="apidocs/com/persistit/Configuration.html#setSysVolume(java.lang.String)">setSysVolume</a>). The value is the name or alias of the selected volume.</p>
</div>
<div class="section" id="configuring-the-journal-path">
<h2>Configuring the Journal Path<a class="headerlink" href="#configuring-the-journal-path" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="PhysicalStorage.html#journal"><em>The Journal</em></a> consists of a series of sequentially numbered files located in directory specified by the configuration parameter <tt class="docutils literal"><span class="pre">journalpath</span></tt>. The application can set this property by calling <tt class="docutils literal"><span class="pre">com.persistit.Configuration#setJournalPath</span></tt> prior to initializing Persistit or through the property:</p>
<div class="highlight-python"><pre>journalpath=/ssd/data/my_app_journal</pre>
</div>
<p>The value specified can be either a</p>
<ul class="simple">
<li>directory, in which case files named <tt class="docutils literal"><span class="pre">persistit_journal.NNNNNNNNNNNN</span></tt> will be created,</li>
<li>or a file name, in which case journal files will be created by appending the suffix <tt class="docutils literal"><span class="pre">.NNNNNNNNNNNN</span></tt>.</li>
</ul>
</div>
<div class="section" id="recommendations-for-physical-media">
<h2>Recommendations for Physical Media<a class="headerlink" href="#recommendations-for-physical-media" title="Permalink to this headline">¶</a></h2>
<p>The journal is written by appending records to the end of the highest-numbered file. Read operations occur while copying page images from the journal to their home volume files. While copying, Persistit attempts to perform large sequential read operations from the journal. Read operations also occur at random when Persistit needs to reload the image of a previously evicted page.</p>
<p>Because of these characteristics a modern enterprise SSD (solid disk drive) is ideally suited for maintaining the journal. If no SSD is available in the server, placing the journal on a different physical disk drive than the volume file(s) can significantly improve performance.</p>
<p>However, beware of consumer-grade SSDs. Some may cache writes and record them on non-volatile storage much later. In a power failure event, committed transactions recorded only in the write cache can be lost. The durability of committed transactions can only be guaranteed if the hardware stack cooperates in making sure all writes are durable.</p>
</div>
<div class="section" id="buffer-pool-preload">
<h2>Buffer Pool Preload<a class="headerlink" href="#buffer-pool-preload" title="Permalink to this headline">¶</a></h2>
<p>Persistit includes an optional facility to record periodically an inventory of pages in the buffer pool. When Persistit starts up it attempts to re-read the same pages that were previously in the buffer pool so that performance after restart on a similar workload (e.g., queries that exhibit a moderate or strong degree of locality-of-reference) will run at full speed. This facility can be especially important in large buffer pool configurations in which under normal workloads a server may otherwise require minutes to hours to reach optimal speed due to a large number of random reads. Re-reading the inventory at startup can be much faster since pages are read in approximate physical order.</p>
<p>This facility is controlled by two configuration parameters:</p>
<ul class="simple">
<li><a class="reference external" href="apidocs/com/persistit/Configuration.html#setBufferInventoryEnabled(boolean)">setBufferInventoryEnabled</a> controls whether Persistit records the inventory. If enabled, the recording happens once per Checkpoint and once at normal shutdown.  The inventory is stored in the system volume.</li>
<li><a class="reference external" href="apidocs/com/persistit/Configuration.html#setBufferPreloadEnabled(boolean)">setBufferPreloadEnabled</a> controls whether Persistit attempts to preload the buffer pool during startup. If there is a recorded inventory Persistit attempts to re-read the pages that were previously present; otherwise it silently continues the startup.</li>
</ul>
<p>If upon restart the buffer pool has become smaller so that the inventory is larger than the current buffer pool, Persistit only loads as many pages as there currently are buffers.</p>
<p>Although by default these configuration properties are false, we recommend enabling them for production servers because the inventory process takes very little time, and buffer preload can restore the buffer pool to a useful working set orders of magnitude faster than warming it up through normal load.</p>
</div>
<div class="section" id="other-configuration-parameters">
<h2>Other Configuration Parameters<a class="headerlink" href="#other-configuration-parameters" title="Permalink to this headline">¶</a></h2>
<p>The following additional properties are defined for Persistit. Other properties may also reside in the Properties object or its backing file; Persistit simply ignores any property not listed here.</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">journalsize</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setJournalSize(long)">setJournalSize</a>)</dt>
<dd>Journal file block size. Default is 1,000,000,000 bytes. A new Persistit rolls over to a new journal file when this
size is reached. Generally there is no reason to adjust this setting.</dd>
<dt><tt class="docutils literal"><span class="pre">appendonly</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setAppendOnly(boolean)">setAppendOnly</a>), True or false (default).</dt>
<dd>When true, Persistit’s journal starts up in <em>append-only</em> mode in which modified pages are only written to the
journal and not copied to their home volumes. As a consequence, all existing journal files are preserved, and new
modifications are written only to newly created journal files. The append-only flag can also be enabled or disabled
by application code and through the JMX and RMI interfaces.</dd>
<dt><tt class="docutils literal"><span class="pre">rmiport</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setRmiPort(int)">setRmiPort</a>)</dt>
<dd>Specifies a port number on which Persistit will create a temporary Remote Method Invocation registry.  If this
property is specified, Persistit creates a registry and registers a <a class="reference external" href="apidocs/com/persistit/Management.html">com.persistit.Management</a> server on it. This
allows remote access to management facilities within Persistit and permits the Swing-based administrative utility to
attach to and manage a Persistit instance running on a headless server. The <tt class="docutils literal"><span class="pre">rmihost</span></tt> and <tt class="docutils literal"><span class="pre">rmiport</span></tt> properties
are mutually exclusive.</dd>
<dt><tt class="docutils literal"><span class="pre">rmihost</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setRmiHost(java.lang.String)">setRmiHost</a>)</dt>
<dd>Specifies the URL of an Remote Method Invocation registry.  If present, Persistit registers its a server for its
<a class="reference external" href="apidocs/com/persistit/Management.html">com.persistit.Management</a> interface at the specified external registry. The <tt class="docutils literal"><span class="pre">rmihost</span></tt> and <tt class="docutils literal"><span class="pre">rmiport</span></tt>
properties are mutually exclusive.</dd>
<dt><tt class="docutils literal"><span class="pre">jmx</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setJmxEnabled(boolean)">setJmxEnabled</a>), True (default) or false.</dt>
<dd>Specifies whether Persistit registers MXBeans with the platform MBean server. Set this value to <tt class="docutils literal"><span class="pre">true</span></tt> to enable
access from <tt class="docutils literal"><span class="pre">jconsole</span></tt> and other management tools.</dd>
<dt><tt class="docutils literal"><span class="pre">serialOverride</span></tt>, <tt class="docutils literal"><span class="pre">constructorOverride</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setSerialOverride(java.lang.String)">setSerialOverride</a> <a class="reference external" href="apidocs/com/persistit/Configuration.html#setConstructorOverride(boolean)">setConstructorOverride</a>)</dt>
<dd>Control aspects of object serialization. See <a class="reference internal" href="Serialization.html#serialization"><em>Serializing Object Values</em></a>.</dd>
<dt><tt class="docutils literal"><span class="pre">showgui</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setShowGUI(boolean)">setShowGUI</a>), True or False (default).</dt>
<dd>If true, Persistit attempts to create and display an instance of the AdminUI utility panel within the current JVM.
Alternatively, AdminUI uses RMI and can be launched and run remotely if <tt class="docutils literal"><span class="pre">rmiport</span></tt> or <tt class="docutils literal"><span class="pre">rmihost</span></tt> has been
specified.</dd>
<dt><tt class="docutils literal"><span class="pre">logfile</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setLogFile(java.lang.String)">setLogFile</a>)</dt>
<dd>Name of a log file to which Persistit’s default logger will write diagnostic log entries. Applications generally
install a logging adapter to reroute messages through Log4J, SLF4J or other logger. The <tt class="docutils literal"><span class="pre">logfile</span></tt> property is used
only when no adapter has been installed.</dd>
<dt><tt class="docutils literal"><span class="pre">bufferinventory</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setBufferInventoryEnabled(boolean)">setBufferInventoryEnabled</a>), True or False (default).</dt>
<dd>If true, Persistit periodically records an inventory of all the pages in the buffers pools to the System Volume. The inventory
enables Persistit to preload the buffer pools then next time it starts up with approximately the same pages that were present
before shutdown. To enable buffer preloading, the bufferpreload property must also be true.</dd>
<dt><tt class="docutils literal"><span class="pre">bufferpreload</span></tt>: (<a class="reference external" href="apidocs/com/persistit/Configuration.html#setBufferPreloadEnabled(boolean)">setBufferPreloadEnabled</a>), True or False (default).</dt>
<dd>If true, and if a buffer pool inventory was previously recorded, Persistit attempts to &#8220;warm up&#8221; the buffer pool
by preloading pages that were present in the buffer pool when Persistit last shut down. This may allow a freshly started
Persistit instance to begin servicing a workload similar to what it had previously been handling without incurring the
cost of many random disk reads to load pages.</dd>
</dl>
</div></blockquote>
<p>For all integer-valued properties, the suffix “K” may be used to represent kilo, “M” for mega, “G” for giga and “T” for tera. For example, “2M” represents the value 2,097,152.</p>
</div>
<div class="section" id="a-configuration-example">
<h2>A Configuration Example<a class="headerlink" href="#a-configuration-example" title="Permalink to this headline">¶</a></h2>
<p>Following is an example of a Persistit configuration properties file:</p>
<div class="highlight-python"><pre>datapath = /var/opt/persistit/data
logpath = /var/log/persistit
logfile = ${logpath}/${timestamp}.log

buffer.count.16384 = 5000

volume.1 = ${datapath}/demo_data, create, pageSize:16K, \
        initialSize:1M, extensionSize:1M, maximumSize:10G, alias:data

volume.2 = ${datapath}/demo_system, create, pageSize:16K, \
        initialSize:100K, extensionSize:100K, maximumSize:1G

sysvolume = demo_system

journalpath = /ssd/persistit_journal</pre>
</div>
<p>With this configuration there will be 5,000 16K buffers in the buffer pool consuming heap space of approximately 93MB including overhead. Persistit will open or create volume files named <tt class="docutils literal"><span class="pre">/var/opt/persistit/data/demo_data</span></tt> and <tt class="docutils literal"><span class="pre">/var/opt/persistit/data/demo_system</span></tt> and a journal file named <tt class="docutils literal"><span class="pre">/ssd/persistit_journal.0000000000000000</span></tt>. Persistit will write diagnostic logging output to a file such as <tt class="docutils literal"><span class="pre">/var/log/persistit/20110523172213.log</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">demo_data</span></tt> volume has the alias <tt class="docutils literal"><span class="pre">data</span></tt>. Application code uses the name &#8220;data&#8221; to refer to it. The <tt class="docutils literal"><span class="pre">sysvolume</span></tt> property specifies that the <tt class="docutils literal"><span class="pre">demo_system</span></tt> volume is designated to hold class meta data for serialized objects.</p>
</div>
<div class="section" id="property-value-substitution">
<h2>Property Value Substitution<a class="headerlink" href="#property-value-substitution" title="Permalink to this headline">¶</a></h2>
<p>This example also illustrates how property value substitution can be used within a Persistit configuration.  The value of the <tt class="docutils literal"><span class="pre">datapath</span></tt> replaces <tt class="docutils literal"><span class="pre">${datapath}</span></tt> in the volume specification. The property name <tt class="docutils literal"><span class="pre">datapath</span></tt> is arbitrary; you may use any valid property name as a substitution variable. Similarly, the value of <tt class="docutils literal"><span class="pre">logpath</span></tt> replaces <tt class="docutils literal"><span class="pre">${logpath}</span></tt> and the pseudo-property <tt class="docutils literal"><span class="pre">${timestamp}</span></tt> expands to a timestamp in the form <tt class="docutils literal"><span class="pre">*yyyyMMddHHmm*</span></tt> to provides a unique time-based log file name.</p>
</div>
<div class="section" id="incorporating-java-system-properties">
<h2>Incorporating Java System Properties<a class="headerlink" href="#incorporating-java-system-properties" title="Permalink to this headline">¶</a></h2>
<p>You may also specify any configuration property as a Java system property with the prefix <tt class="docutils literal"><span class="pre">com.persisit.</span></tt> System properties override values specified as properties. For example, you can override the value of <tt class="docutils literal"><span class="pre">buffer.count.8192</span></tt> specifying:</p>
<div class="highlight-python"><pre>java -Dcom.persistit.buffer.count.8192=10K -jar MyJar</pre>
</div>
<p>This is also true for substitution property values. For example, <tt class="docutils literal"><span class="pre">-Dcom.persistit.logpath=/tmp/</span></tt> will place the log files in the <tt class="docutils literal"><span class="pre">/tmp</span></tt> directory rather than <tt class="docutils literal"><span class="pre">/var/log/persistit</span></tt> as specified by the configuration file.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#configuring-the-buffer-pool">Configuring the Buffer Pool</a></li>
<li><a class="reference internal" href="#heap-tuning">Heap Tuning</a></li>
<li><a class="reference internal" href="#multiple-buffer-pools">Multiple Buffer Pools</a></li>
<li><a class="reference internal" href="#configuring-volumes">Configuring Volumes</a></li>
<li><a class="reference internal" href="#system-volume">System Volume</a></li>
<li><a class="reference internal" href="#configuring-the-journal-path">Configuring the Journal Path</a></li>
<li><a class="reference internal" href="#recommendations-for-physical-media">Recommendations for Physical Media</a></li>
<li><a class="reference internal" href="#buffer-pool-preload">Buffer Pool Preload</a></li>
<li><a class="reference internal" href="#other-configuration-parameters">Other Configuration Parameters</a></li>
<li><a class="reference internal" href="#a-configuration-example">A Configuration Example</a></li>
<li><a class="reference internal" href="#property-value-substitution">Property Value Substitution</a></li>
<li><a class="reference internal" href="#incorporating-java-system-properties">Incorporating Java System Properties</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="PhysicalStorage.html"
                        title="previous chapter">Physical B+Tree Representation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Management.html"
                        title="next chapter">Management</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="Management.html" title="Management"
             >next</a></li>
        <li class="right" >
          <a href="PhysicalStorage.html" title="Physical B+Tree Representation"
             >previous</a> |</li>
        <li><a href="index.html">Persistit 3.3.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Akiban Technologies.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>